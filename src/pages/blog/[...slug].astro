---
import { getCollection } from 'astro:content';
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  // Sort by date, newest first
  const sortedEntries = blogEntries.sort((a, b) => 
    new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  );
  
  return sortedEntries.map((entry, index) => ({
    params: { slug: entry.slug },
    props: { 
      entry,
      // Previous is newer (earlier in array), Next is older (later in array)
      prevPost: index > 0 ? sortedEntries[index - 1] : null,
      nextPost: index < sortedEntries.length - 1 ? sortedEntries[index + 1] : null,
    },
  }));
}

const { entry, prevPost, nextPost } = Astro.props;
const { Content, headings, remarkPluginFrontmatter } = await entry.render();
---

<BlogPostLayout 
  title={entry.data.title} 
  description={entry.data.description}
  publishDate={entry.data.date}
  tags={entry.data.tags}
  icon={entry.data.icon}
  headings={headings}
  minutesRead={remarkPluginFrontmatter?.minutesRead}
  prevPost={prevPost ? { slug: prevPost.slug, title: prevPost.data.title } : null}
  nextPost={nextPost ? { slug: nextPost.slug, title: nextPost.data.title } : null}
  slug={entry.slug}
>
  <Content />
</BlogPostLayout>
