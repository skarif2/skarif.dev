---
import 'photoswipe/style.css';
import { getImage } from 'astro:assets';
import './TravelGallery.css';

// Import images directly
import bergenNorway from '../../content/pages/assets/bergen-norway.webp';
import mountEverest from '../../content/pages/assets/mount-everest.webp';
import phewaLake from '../../content/pages/assets/phewa-lake.webp';
import louvreMuseum from '../../content/pages/assets/louvre-museum.webp';
import barcelonetaBeach from '../../content/pages/assets/barceloneta-beach.webp';
import eiffelTower from '../../content/pages/assets/eiffel-tower.webp';
import himalayas from '../../content/pages/assets/himalayas.webp';

const travelPhotos = [
  {
    id: 'bergen',
    image: bergenNorway,
    alt: 'Bergen, Norway',
    place: 'Bergen, Norway',
    date: '2023',
    description: 'The colorful Hanseatic wharf of Bryggen, a UNESCO World Heritage site.',
    style: { width: '100%', height: '350px', objectFit: 'cover', objectPosition: 'bottom center', borderRadius: '16px', marginBottom: '0.5rem' }
  },
  {
    id: 'everest',
    image: mountEverest,
    alt: 'Mount Everest',
    place: 'Solukhumbu, Nepal',
    date: '2022',
    description: 'The highest peak on Earth, towering majestically above the clouds.',
    gridClass: 'col-start-1 row-start-1',
  },
  {
    id: 'phewa',
    image: phewaLake,
    alt: 'Phewa Lake',
    place: 'Pokhara, Nepal',
    date: '2022',
    description: 'A serene reflection of the Annapurna range on the calm waters of Phewa Lake.',
    gridClass: 'col-start-1 row-start-2',
  },
  {
    id: 'louvre',
    image: louvreMuseum,
    alt: 'Louvre Museum',
    place: 'Paris, France',
    date: '2023',
    description: 'The iconic glass pyramid entrance of the world\'s largest art museum.',
    gridClass: 'col-start-2 row-span-2',
  },
  {
    id: 'barceloneta',
    image: barcelonetaBeach,
    alt: 'Barceloneta Beach',
    place: 'Barcelona, Spain',
    date: '2023',
    description: 'Golden sands and Mediterranean vibes at one of Barcelona\'s most famous beaches.',
    gridClass: 'col-start-3 col-span-2 row-start-1',
  },
  {
    id: 'eiffel',
    image: eiffelTower,
    alt: 'Eiffel Tower',
    place: 'Paris, France',
    date: '2023',
    description: 'The Iron Lady sparkling against the Parisian sky.',
    gridClass: 'col-start-3 row-start-2',
  },
  {
    id: 'himalayas',
    image: himalayas,
    alt: 'Himalayas',
    place: 'Himalayas',
    date: '2022',
    description: 'The vast and rugged terrain of the Himalayan mountain range.',
    gridClass: 'col-start-4 row-start-2',
  }
];

const gridPhotos = await Promise.all(
  travelPhotos.map(async (photo) => {
    // Optimized thumbnail for grid
    const thumbnail = await getImage({ 
      src: photo.image, 
      format: 'webp',
      width: 800,
      quality: 80 
    });

    // High-res version for lightbox
    const fullSize = await getImage({
      src: photo.image,
      format: 'webp',
      width: 1600,
      quality: 100
    });

    return {
      ...photo,
      src: thumbnail.src,
      href: fullSize.src,
      width: fullSize.options.width,
      height: fullSize.options.height,
    };
  })
);

// Helper for inline grid styles 
// (We could move this to a utility, but kept local for simplicity as requested)
function getGridStyle(gridClass?: string) {
  const style: any = {};
  if (gridClass?.includes('col-start-1')) style.gridColumnStart = '1';
  if (gridClass?.includes('col-start-2')) style.gridColumnStart = '2';
  if (gridClass?.includes('col-start-3')) style.gridColumnStart = '3';
  if (gridClass?.includes('col-start-4')) style.gridColumnStart = '4';
  if (gridClass?.includes('row-start-1')) style.gridRowStart = '1';
  if (gridClass?.includes('row-start-2')) style.gridRowStart = '2';
  if (gridClass?.includes('col-span-2')) style.gridColumnEnd = 'span 2';
  if (gridClass?.includes('row-span-2')) style.gridRowEnd = 'span 2';
  return style;
}

const heroPhoto = gridPhotos[0];
const restPhotos = gridPhotos.slice(1);
---

<div class="travel-gallery" id="travel-gallery">
  {/* Hero Image */}
  {heroPhoto && (
    <a 
      href={heroPhoto.href}
      data-pswp-width={heroPhoto.width}
      data-pswp-height={heroPhoto.height}
      target="_blank"
      class="hero-link"
      style={heroPhoto.style}
    >
      <img
        src={heroPhoto.src}
        alt={heroPhoto.alt}
        style={{
          width: '100%',
          height: '100%',
          objectFit: 'cover',
          objectPosition: 'bottom center',
          borderRadius: '16px',
          display: 'block'
        }}
      />
    </a>
  )}

  {/* Grid Images */}
  <div class="gallery-grid">
    {restPhotos.map((photo) => (
      <a
        href={photo.href}
        data-pswp-width={photo.width}
        data-pswp-height={photo.height}
        target="_blank"
        class={`grid-item ${photo.gridClass || ''}`}
        style={{
          borderRadius: '16px',
          overflow: 'hidden',
          display: 'block',
          position: 'relative',
          ...getGridStyle(photo.gridClass)
        }}
      >
        <img
          src={photo.src}
          alt={photo.alt}
          style={{
            width: '100%',
            height: '100%',
            objectFit: 'cover',
            display: 'block',
            transition: 'transform 0.3s ease'
          }}
        />
      </a>
    ))}
  </div>
</div>

<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#travel-gallery',
    children: 'a',
    pswpModule: () => import('photoswipe'),
    paddingFn: (viewportSize) => {
      return {
        top: viewportSize.y < 600 ? 20 : 50,
        bottom: viewportSize.y < 600 ? 50 : 100, // Minimal bottom padding
        left: 0,
        right: 0
      };
    }
  });

  lightbox.init();
</script>
