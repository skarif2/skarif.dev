---
import Tag from '../ui/Tag.astro';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { resolveBlogIcon } from '../../utils/blogIcon';
import './BlogPostItem.css';

interface Props {
  post: CollectionEntry<'blog'> & { readingTime?: string };
  variant?: 'default' | 'compact';
}

const { post, variant = 'default' } = Astro.props;

const dateObj = new Date(post.data.date);
const formattedDate = dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
const icon = post.data.icon;
const tags = post.data.tags ?? [];
const isCompact = variant === 'compact';

const iconSource = resolveBlogIcon(icon, dateObj);
---

<article class={`post-item ${isCompact ? 'is-compact' : ''}`}>
  <div class="post-content-wrapper">
    <div class="post-icon">
      {typeof iconSource === 'string' ? (
        <img src={iconSource} alt={post.data.title} />
      ) : (
        <Image src={iconSource} alt={post.data.title} />
      )}
    </div>
    <div class="post-content">
      <h3 class="post-title">
        <a href={`/blog/${post.slug}`} class="post-title-link">
          {post.data.title}
        </a>
      </h3>
      
      {!isCompact && post.data.description && (
        <p class="post-description">{post.data.description}</p>
      )}
      
      <div class="post-meta">
        <time datetime={dateObj.toISOString()}>{formattedDate}</time>
        <span class="meta-separator">â€¢</span>
        <span class="reading-time">{post.readingTime}</span>
      </div>
    </div>
    
    {tags.length > 0 && (
      <div class="post-tags">
        {tags.map(tag => (
          <Tag tag={tag} />
        ))}
      </div>
    )}
  </div>
</article>
