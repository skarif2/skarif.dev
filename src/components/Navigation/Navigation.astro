---
import { ThemeToggle } from '../ThemeToggle/ThemeToggle';
import { MobileMenuToggle } from '../MobileMenuToggle/MobileMenuToggle';
import './Navigation.css';

interface Props {
  title?: string;
}

const { title = 'skarif.dev' } = Astro.props;
---

<header class="navigation">
  <div class="nav-left">
    <div id="mobile-menu-container"></div>
    <a href="/" class="nav-title">{title}</a>
  </div>
  
  <div class="nav-controls">
    <ThemeToggle client:load />
  </div>
</header>

<script>
  import { MobileMenuToggle } from '../MobileMenuToggle/MobileMenuToggle';
  import { createElement } from 'react';
  import { createRoot } from 'react-dom/client';

  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('mobile-menu-container');
    const sidebar = document.getElementById('sidebar');
    
    if (container && sidebar) {
      let isOpen = false;
      const root = createRoot(container);

      const handleToggle = () => {
        isOpen = !isOpen;
        sidebar.classList.toggle('is-open', isOpen);
        document.body.style.overflow = isOpen ? 'hidden' : '';
        
        // Re-render the component with new state
        render();
      };
      
      const render = () => {
        root.render(
          createElement(MobileMenuToggle, {
            isOpen,
            onToggle: handleToggle
          })
        );
      };
      
      render();
      
      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (isOpen && 
            !sidebar.contains(e.target as Node) && 
            !container.contains(e.target as Node)) {
          handleToggle();
        }
      });
    }
  });
</script>
